---
- name: Ensure MySQL config sections exist
  lineinfile:
    dest: "{{ mysql_config_filepath }}"
    line: '[{{ item }}]'
    create: true
  with_items:
    - mysqld
  become: true

- name: Ensure MySQL config options
  lineinfile:
    dest: "{{ mysql_config_filepath }}"
    regexp: "^{{ item.option }}="
    line: "{{ item.option }}={{ item.value }}"
    insertafter: '^\[{{ item.section }}\]'
  with_items:
    - { section: mysqld, option: default-authentication-plugin, value: '{{ mysql_authentication_plugin }}' }
  become: true
